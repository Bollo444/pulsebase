# PulseBase - API Documentation (Core Examples)

This document provides examples for core API endpoints. Full OpenAPI/Swagger documentation will be generated by the platform.

## Authentication API

### `POST /auth/v1/signup`
Register a new user.

**Request Body:**
```json
{
  "email": "user@example.com",
  "password": "securepassword123"
}
```

**Response (200 OK):**
```json
{
  "id": "usr_1234567890",
  "aud": "authenticated",
  "role": "authenticated",
  "email": "user@example.com",
  "created_at": "2023-07-15T10:00:00Z",
  "access_token": "your_jwt_access_token",
  "refresh_token": "your_jwt_refresh_token",
  "expires_in": 3600
}
```

### `POST /auth/v1/token?grant_type=password`
Sign in a user.

**Request Body:**
```json
{
  "email": "user@example.com",
  "password": "securepassword123"
}
```

**Response (200 OK):** (Similar to signup response)

### `POST /auth/v1/signout`
Sign out the current user (invalidates tokens).

**Request Headers:**
`Authorization: Bearer your_jwt_access_token`

**Response (204 No Content)**

## Database API (RESTful)

Base URL: `/rest/v1/`

### `GET /rest/v1/{table_name}`
List rows from a table. Supports filtering, sorting, pagination via query parameters (e.g., `?select=column1,column2&id=eq.1&order=created_at.desc&limit=10&offset=0`).

**Request Headers:**
`Authorization: Bearer your_jwt_access_token`
`Apikey: your_project_api_key`

**Response (200 OK):**
```json
[
  {
    "id": 1,
    "column1": "value1",
    "created_at": "2023-07-15T10:05:00Z"
  },
  {
    "id": 2,
    "column1": "value2",
    "created_at": "2023-07-15T10:10:00Z"
  }
]
```

### `POST /rest/v1/{table_name}`
Create a new row in a table.

**Request Headers:** (Same as GET)
`Prefer: return=representation` (Optional: to get the created row back)

**Request Body:**
```json
{
  "column1": "new_value",
  "column2": 123
}
```

**Response (201 Created):** (If `Prefer: return=representation` is used)
```json
[
  {
    "id": 3,
    "column1": "new_value",
    "column2": 123,
    "created_at": "2023-07-15T10:15:00Z"
  }
]
```

### `PATCH /rest/v1/{table_name}?{filter_column}=eq.{value}`
Update rows matching the filter.

**Request Headers:** (Same as GET)

**Request Body:**
```json
{
  "column1": "updated_value"
}
```

**Response (200 OK or 204 No Content)**

### `DELETE /rest/v1/{table_name}?{filter_column}=eq.{value}`
Delete rows matching the filter.

**Request Headers:** (Same as GET)

**Response (200 OK or 204 No Content)**

## Vector Search API

### `POST /rest/v1/rpc/generate_embeddings`
Generate embeddings for input text.

**Request Headers:** (Same as Database GET)

**Request Body:**
```json
{
  "input_text": "This is a document to embed.",
  "model": "text-embedding-ada-002" // Optional, uses project default if not provided
}
```

**Response (200 OK):**
```json
{
  "embedding": [0.0023, -0.0034, ..., 0.0123]
}
```

### `POST /rest/v1/rpc/vector_search`
Perform a similarity search on a table with a vector column.

**Request Headers:** (Same as Database GET)

**Request Body:**
```json
{
  "table": "documents",
  "vector_column": "embedding",
  "query_text": "How do I reset my password?", // Text to convert to query vector
  // OR "query_vector": [0.0023, ...], // Provide vector directly
  "filter": "category = 'help'", // Optional: SQL WHERE clause for pre-filtering
  "limit": 5,
  "similarity_threshold": 0.75 // Optional
}
```

**Response (200 OK):**
```json
{
  "results": [
    {
      "id": "doc_123456",
      "title": "Password Reset Guide",
      "content": "To reset your password, click on the 'Forgot Password' link...",
      "similarity_score": 0.92
    },
    {
      "id": "doc_789012",
      "title": "Account Security",
      "content": "Managing your account security includes regular password updates...",
      "similarity_score": 0.85
    }
  ],
  "execution_time_ms": 45
}
```

## Analytics API

### `GET /projects/{project_id}/dashboards`
List all dashboards for the project.

**Request Headers:**
`Authorization: Bearer your_jwt_access_token`

**Response (200 OK):**
```json
{
  "dashboards": [
    {
      "id": "dash_123456",
      "name": "User Metrics",
      "description": "Key user engagement metrics",
      "created_at": "2023-06-22T11:15:30Z",
      "created_by": "usr_789012"
    }
  ]
}
```

### `POST /projects/{project_id}/dashboards`
Create a new dashboard.

**Request Headers:** (Same as GET)

**Request Body:**
```json
{
  "name": "Sales Overview",
  "description": "Key sales metrics and trends",
  "charts": [
    {
      "name": "Monthly Revenue",
      "type": "line",
      "query": "SELECT date_trunc('month', created_at) as month, SUM(amount) as revenue FROM orders GROUP BY month ORDER BY month",
      "refresh_interval_minutes": 60
    }
  ]
}
```

**Response (201 Created):**
```json
{
  "id": "dash_234567",
  "name": "Sales Overview",
  "description": "Key sales metrics and trends",
  "created_at": "2023-07-15T16:20:15Z",
  "created_by": "usr_123456"
}
```

### `GET /projects/{project_id}/dashboards/{dashboard_id}/data`
Get all data for a dashboard's visualizations.

**Request Headers:** (Same as GET)

**Response (200 OK):**
```json
{
  "dashboard": {
    "id": "dash_234567",
    "name": "Sales Overview"
  },
  "charts": [
    {
      "id": "chart_123456",
      "name": "Monthly Revenue",
      "data": [
        {
          "month": "2023-01-01T00:00:00Z",
          "revenue": 45678.90
        },
        {
          "month": "2023-02-01T00:00:00Z",
          "revenue": 52345.80
        }
      ],
      "last_updated": "2023-07-15T16:25:30Z"
    }
  ]
}
```

## Cache Management API

### `GET /projects/{project_id}/cache/stats`
Get cache performance statistics.

**Request Headers:**
`Authorization: Bearer your_jwt_access_token`

**Response (200 OK):**
```json
{
  "hit_rate": 0.87,
  "miss_rate": 0.13,
  "total_entries": 1256,
  "memory_usage_mb": 45.6,
  "average_response_time_ms": 12
}
```

### `POST /projects/{project_id}/cache/invalidate`
Invalidate specific cache entries.

**Request Headers:** (Same as GET)

**Request Body:**
```json
{
  "table": "products", // Optional: invalidate all for a table
  "keys": ["prod_123", "prod_456"], // Optional: specific keys
  "pattern": null // Optional: invalidate by pattern
}
```

**Response (200 OK):**
```json
{
  "invalidated_entries": 2,
  "status": "success"
}
```

## Organization Management API

### `GET /organizations`
List all organizations the user belongs to.

**Request Headers:**
`Authorization: Bearer your_jwt_access_token`

**Response (200 OK):**
```json
{
  "organizations": [
    {
      "id": "org_123456",
      "name": "Acme Inc",
      "role": "admin",
      "created_at": "2023-05-10T09:12:45Z"
    }
  ]
}
```

### `POST /organizations`
Create a new organization.

**Request Headers:** (Same as GET)

**Request Body:**
```json
{
  "name": "New Company",
  "slug": "new-company"
}
```

**Response (201 Created):**
```json
{
  "id": "org_234567",
  "name": "New Company",
  "slug": "new-company",
  "created_at": "2023-07-15T16:45:30Z",
  "created_by": "usr_123456"
}
```

### `POST /organizations/{organization_id}/invitations`
Invite a user to the organization.

**Request Headers:** (Same as GET)

**Request Body:**
```json
{
  "email": "collaborator@example.com",
  "role": "developer"
}
```

**Response (201 Created):**
```json
{
  "id": "inv_123456",
  "email": "collaborator@example.com",
  "role": "developer",
  "expires_at": "2023-07-22T16:50:30Z",
  "status": "pending"
}
```

## RAG API

### `POST /projects/{project_id}/rag/query`
Query your data using RAG (Retrieval Augmented Generation).

**Request Headers:**
`Authorization: Bearer your_jwt_access_token`

**Request Body:**
```json
{
  "query": "What are our sales trends for Q1?",
  "collection": "business_documents", // Name of the document collection to query
  "model": "gpt-4", // Optional: LLM to use
  "max_tokens": 500, // Optional
  "temperature": 0.7, // Optional
  "context_size": 5 // Optional: Number of retrieved documents to use as context
}
```

**Response (200 OK):**
```json
{
  "answer": "Based on your sales data, Q1 showed a 15% increase year-over-year with particularly strong performance in March...",
  "sources": [
    {
      "id": "doc_123456",
      "title": "Q1 Sales Report",
      "relevance_score": 0.92
    },
    {
      "id": "doc_234567",
      "title": "2023 Revenue Forecast",
      "relevance_score": 0.85
    }
  ],
  "tokens_used": 320,
  "execution_time_ms": 1240
}
```

### `POST /projects/{project_id}/rag/configure`
Create or update a RAG configuration.

**Request Headers:** (Same as GET)

**Request Body:**
```json
{
  "name": "SalesAssistant",
  "description": "AI assistant for sales data analysis",
  "collections": ["sales_reports", "customer_feedback"],
  "default_model": "gpt-4",
  "system_prompt": "You are a sales analysis assistant. Analyze data from PulseBase to provide insights on sales trends and customer behavior."
}
```

**Response (201 Created or 200 OK):**
```json
{
  "id": "rag_123456",
  "name": "SalesAssistant",
  "description": "AI assistant for sales data analysis",
  "created_at": "2023-07-15T17:10:30Z",
  "created_by": "usr_123456",
  "status": "active"
}
```
